<tool id="NMR_Read" name="NMR_Read" version="3.0.1">
	<description> Read NMR raw files</description>
	
    <stdio>
        <exit_code range="1:" level="fatal" />
    </stdio>
	
  	<command>
  	    ## Wrapper
        Rscript $__tool_directory__/ReadFids_wrapper.R

		## File input
        fidzipfile $fidzipfile
		
		## Title line
		title_line $title_line
		
		## Subdirectories
		subdirectories $subdirectories
		
		## Use subdirectories names as FID names?
		dirs_names $dirs_names

        ## Outputs
        dataMatrix $dataMatrix
        sampleMetadata $sampleMetadata
        logOut $logOut
        graphOut $graphOut
		
	</command>
		
  	<inputs>
		<param name="fidzipfile" type="data" format="no_unzip.zip" label="Bruker FID file" />
        
		<param name="title_line" label="FID title" type="integer" value="1" size="100" help="Default value is line 1"/>

        <param name="subdirectories" label="Presence of subdirectories?" type="select" help="Select 'FALSE' when there is no subdirectories, 'TRUE' if there are subdirectories">
            <option value="FALSE"> FALSE </option>
            <option value="TRUE"> TRUE </option>
        </param>
        
        <param name="dirs_names" label="Use (sub)directories names as FID names?" type="select" help="Select 'TRUE' to use the subdirectories names as the FID names">
            <option value="FALSE"> FALSE </option>
            <option value="TRUE"> TRUE </option>
        </param>
	</inputs>	

	
	
	<outputs>
		<data format="tabular" name="dataMatrix" label="${tool.name}_dataMatrix" />
		<data format="tabular" name="sampleMetadata" label="${tool.name}_sampleMetadata" />
		<data format="txt" name="logOut" label="${tool.name}_log" />
		<data format="pdf" name="graphOut" label="${tool.name}_graph" />
	</outputs>


	<tests>
        <test>
          <param name="fidzipfile" value="MTBLS1.zip" ftype="zip" />
          <param name="title_line" value="1" />
          <param name="subdirectories" value="TRUE" />
          <param name="dirs_names" value="TRUE" />
           
          <output name="dataMatrix" value="NMR_ReadFids_dataMatrix.tabular" />
  
        </test>
  </tests>

  
  
	<help>

.. class:: infomark

**Authors** Manon Martin (manon.martin@uclouvain.be) and Marie Tremblay-Franco (marie.tremblay-franco@inra.fr; Galaxy integration)

.. class:: infomark


=============
NMR Read
=============

-----------
Description
-----------

Nuclear Magnetic Resonance files reading (from the R 'SOAP' package)

-----------------
Workflow position
-----------------

**Upstream tools**

========================= ================= =======
Name                      output file       format
========================= ================= =======
NA                        NA                NA
========================= ================= =======


**Downstream tools**

+---------------------------+----------------------+--------+
| Name                      | Output file          | Format |
+===========================+======================+========+
|NMR_PreProcessing          | dataMatrix           | Tabular|
+---------------------------+----------------------+--------+
|                           | log                  | Tabular|
+---------------------------+----------------------+--------+
|                           | variableMetadata     | Tabular|
+---------------------------+----------------------+--------+
|                           | graph                | PDF    |
+---------------------------+----------------------+--------+
|NMR_Alignement             | dataMatrix           | Tabular|
+---------------------------+----------------------+--------+
|NMR_Bucketing              | dataMatrix           | Tabular|
+---------------------------+----------------------+--------+
|Normalization              | dataMatrix           | Tabular|
+---------------------------+----------------------+--------+
|Univariate                 | variableMetadata     | Tabular|
+---------------------------+----------------------+--------+
|Multivariate               | sampleMetadata       | Tabular|
+---------------------------+----------------------+--------+
|                           | variableMetadata     | Tabular|
+---------------------------+----------------------+--------+


-----------
Input files
-----------

+---------------------------+-----------------+
| Parameter : num + label   |   Format        |
+===========================+=================+
| 1 : Choose your inputs    |   Raw Bruker    |
+---------------------------+-----------------+


**Choose your inputs**

    | Zip file (recommended) of FID Bruker files: you can put a zip file containing your FID Bruker files: myinputs.zip (containing all your conditions as sub-directories).


----------
Parameters
----------

FID Title
	| Line in the acqus file to find the FID title (name)
	|

subdirectories
	| Organization of individual's files
	| TRUE: will search inside subdirectories for FIDs and will merge them to have unique FID and info matrices.
	|
	
dirs_names
	| Use the (sub)directories names as FID names?
	|
	
	
------------
Output files
------------

NMR_Read_dataMatrix
	| tabular output
	| Data matrix with n rows (samples) and p columns (time) containing the raw FIDs.
	|

NMR_Read_sampleMetadata
	| tabular output
	| Data matrix with n rows (samples) containing the acquisition parameters for each sample.
	|
	
NMR_Read_log
	| Text output
	| Contains warnings

	
NMR_Read_graph
	| pdf output
	| line plots of FID
	|


   </help>
   
   
   <citations>
     
     <citation type="bibtex">@PhDThesis{Rousseau2011,
      title = {Statistical contribution to the analysis of metabonomics data in $^1$H NMR spectroscopy.},
      author = {Rousseau, R.},
      school = {Institut de Statistique, Biostatistique et Sciences Actuarielles, Universit{\'e} catholique de Louvain},
      year = {2011}}
      </citation>
      
   </citations> 
   
   
</tool>
